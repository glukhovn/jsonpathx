CREATE EXTENSION jsonpathx;
SELECT jsonpath_embed_vars('$.a + $a', '"aaa"');
 jsonpath_embed_vars 
---------------------
 ($."a" + $"a")
(1 row)

SELECT jsonpath_embed_vars('$.a + $a', '{"b": "abc"}');
 jsonpath_embed_vars 
---------------------
 ($."a" + $"a")
(1 row)

SELECT jsonpath_embed_vars('$.a + $a', '{"a": "abc"}');
 jsonpath_embed_vars 
---------------------
 ($."a" + "abc")
(1 row)

SELECT jsonpath_embed_vars('$.a + $a.double()', '{"a": "abc"}');
   jsonpath_embed_vars    
--------------------------
 ($."a" + "abc".double())
(1 row)

SELECT jsonpath_embed_vars('$.a + $a.x.double()', '{"a": {"x": -12.34}}');
ERROR:  cannot embed non-scalar jsonpath variables
SELECT jsonpath_embed_vars('$[*] ? (@ > $min && @ <= $max)', '{"min": -1.23, "max": 5.0}');
     jsonpath_embed_vars      
------------------------------
 $[*]?(@ > -1.23 && @ <= 5.0)
(1 row)

SELECT jsonpath_embed_vars(jsonpath_embed_vars('$[*] ? (@ > $min && @ <= $max)', '{"min": -1.23}'), '{"max": 5.0}');
     jsonpath_embed_vars      
------------------------------
 $[*]?(@ > -1.23 && @ <= 5.0)
(1 row)

DROP EXTENSION jsonpathx;
